# ============================================================
# Test File for Parts 6-10: Data Ordering, Aggregation, 
# Reshaping, Combining, and Advanced Operations
# ============================================================

# Load sample data for testing
load csv "data/sales_data.csv" as sales

# ============================================================
# PART 6: DATA ORDERING OPERATIONS
# ============================================================

# Test sort_index - Sort by index
sort_index sales ascending=true as sorted_by_idx

# Test rank - Assign ranks to values (using 'price' column)
rank sales column price method="dense" ascending=false as ranked_sales

# ============================================================
# PART 7: AGGREGATION & GROUPING OPERATIONS
# ============================================================

# Test rolling operations (using 'price' column)
rolling_mean sales column price window=3 as mean_roll
rolling_sum sales column price window=3 as sum_roll
rolling_std sales column price window=3 as std_roll
rolling_min sales column price window=3 as min_roll
rolling_max sales column price window=3 as max_roll

# Test expanding operations  
expanding_mean sales column price as cumul_avg
expanding_sum sales column price as cumul_total
expanding_min sales column price as cumul_min
expanding_max sales column price as cumul_max

# Test window functions
window_lag sales column price periods=1 as lagged_data
window_lead sales column price periods=1 as lead_data

# ============================================================
# PART 8: DATA RESHAPING OPERATIONS
# ============================================================

# Test transpose
transpose sales as transposed_data

# ============================================================
# PART 9: DATA COMBINING OPERATIONS
# ============================================================

# First create two subsets to test combining
head sales with n=5 as first_half
tail sales with n=5 as second_half

# Test concat_vertical - Stack dataframes vertically
concat_vertical [first_half, second_half] ignore_index=true as combined_v

# Test concat_horizontal - Stack dataframes horizontally  
concat_horizontal [first_half, second_half] as combined_h

# Test union - Combine with deduplication
union first_half with second_half as unioned_data

# ============================================================
# PART 10: ADVANCED OPERATIONS
# ============================================================

# Test set_index - Set column as index (using 'product_id' column)
set_index sales column product_id drop=true as indexed_by_product

# Test reset_index - Reset index to column
reset_index indexed_by_product drop=false as reset_sales

# Test assign - Assign constant value to new column
assign sales column status value="active" as with_status

# Display some results to verify
describe ranked_sales
describe mean_roll
describe combined_v

